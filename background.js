chrome.runtime.onMessage.addListener(((r,e,t)=>((async()=>{try{if("SA_DOWNLOAD_DATAURL"===r?.type){const{dataUrl:e,filename:a}=r;return void chrome.downloads.download({url:e,filename:a,conflictAction:"uniquify"},(()=>{chrome.runtime.lastError?t({ok:!1,error:chrome.runtime.lastError.message}):t({ok:!0})}))}if("SA_FETCH_AB"===r?.type){const e=await fetch(r.url);if(!e.ok)throw new Error(`Fetch ${e.status}`);const a=await e.arrayBuffer(),o=e.headers.get("content-type")||"",n=new Uint8Array(a);let s="";const i=32768;for(let r=0;r<n.length;r+=i)s+=String.fromCharCode.apply(null,Array.from(n.subarray(r,r+i)));const c=btoa(s);t({ok:!0,dataUrl:`data:${o};base64,${c}`,mime:o})}else{if("SA_FETCH_TEXT"!==r?.type)return;{const e=await fetch(r.url);if(!e.ok)throw new Error(`Fetch ${e.status}`);const a=await e.text();t({ok:!0,text:a})}}t({ok:!1,error:"Unknown message"})}catch(r){t({ok:!1,error:String(r)})}})(),!0))),chrome.runtime.onMessage.addListener(((r,e,t)=>((async()=>{try{}catch(r){t({ok:!1,error:String(r)})}})(),!0))),chrome.commands.onCommand.addListener((async r=>{if("download_seaart_image"===r){const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});r?.id&&chrome.tabs.sendMessage(r.id,{type:"SA_TRIGGER"})}}));